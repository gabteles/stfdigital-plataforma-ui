{"version":3,"sources":["processos/pesquisa-avancada/directives/search-builder/search-builder.controller.ts"],"names":[],"mappings":"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","file":"processos/pesquisa-avancada/directives/search-builder/search-builder.controller.js","sourcesContent":["module app.processos.pesquisaAvancada {\r\n    'use strict';\r\n    import IScope = angular.IScope;\r\n\r\n    interface SearchBuilderScope extends IScope {\r\n        traits: ITrait[];\r\n        search: ISearch;\r\n    }\r\n    \r\n    export class SearchBuilderController {\r\n        \r\n        public logicalOperators: string[] = ['E', 'OU', 'NAO'];\r\n        public comparisonOperators: Object = {\r\n            'IGUAL': ['string', 'number', 'currency', 'date', 'list'],\r\n            'CONTEM': ['string'],\r\n            'ENTRE': ['number', 'currency', 'date'],\r\n            'MAIOR-QUE': ['number', 'currency', 'date'],\r\n            'MENOR-QUE': ['number', 'currency', 'date'],\r\n            'EXISTE': ['constant', 'string', 'number', 'currency', 'date', 'list']\r\n        };\r\n        public traitSearchText: string = '';\r\n        public newCriteria: ICriteria = <ICriteria> {\r\n            logicalOperator: 'E',\r\n            trait: null\r\n        };\r\n        public traits: ITrait[];\r\n        public search: ISearch;\r\n        public criteriaOrder = '';\r\n        public sortableOptions: Object = {\r\n            ghostClass: 'criteria-item-placeholder',\r\n            handle: '.handle',\r\n            forceFallback: true,\r\n            fallbackClass: 'criteria-item-ghost'\r\n        };\r\n        \r\n        /** @ngInject **/\r\n        constructor($scope: SearchBuilderScope) {\r\n            this.traits = $scope.traits;\r\n            this.search = $scope.search;\r\n        }\r\n\r\n        public setCriteriaLogicalOperator(criteria: ICriteria, operator: string): void {\r\n            criteria.logicalOperator = operator;\r\n        }\r\n\r\n        public setAsFavorite(criteria: ICriteria): void {\r\n            criteria.isFavorite = !criteria.isFavorite;\r\n        }\r\n\r\n        public removeCriteria(i): void {\r\n            _.pullAt(this.search.criterias, i);\r\n        }\r\n\r\n        public querySearch(query): ITrait[] {\r\n            return query ? _.filter(this.traits, this.createFilterFor(query)) : this.traits;\r\n        }\r\n\r\n        public addNewCriteria(): void {\r\n            var trait: ITrait = this.newCriteria.trait;\r\n            var criteria: ICriteria = <ICriteria> {\r\n                id: null,\r\n                logicalOperator: this.newCriteria.logicalOperator,\r\n                comparisonOperator: trait.dataType === 'constant' ? 'EXISTE' : 'IGUAL',\r\n                trait: trait,\r\n                value: trait.dataType === 'constant' ? trait.name : null,\r\n                isFavorite: false,\r\n                valid: false\r\n            };\r\n            this.traitSearchText = '';\r\n            this.newCriteria.trait = null;\r\n            this.search.criterias.push(criteria);\r\n        }\r\n\r\n        public getComparisonOperators(dataType): Object {\r\n            var operatorMapping = this.comparisonOperators;\r\n            var ops = _.keys(operatorMapping);\r\n            return _.reject(ops, function(op) {\r\n                var types = operatorMapping[op];\r\n                return !_.includes(types, dataType);\r\n            });\r\n        }\r\n\r\n        private createFilterFor(query): Function {\r\n            var lowercaseQuery = angular.lowercase(query);\r\n            return (trait: ITrait): boolean => {\r\n                if (trait.name.toLowerCase().indexOf(lowercaseQuery) !== -1) {\r\n                    return true;\r\n                }\r\n    \r\n                if (trait.dataType === 'list') {\r\n                    return _.some(trait.values, (value) => {\r\n                        return value.toLowerCase().indexOf(lowercaseQuery) !== -1;\r\n                    });\r\n                }\r\n                return false;\r\n            };\r\n        }\r\n    }\r\n\r\n    angular\r\n        .module('app.processos.pesquisa-avancada')\r\n        .controller('app.processos.pesquisa-avancada.SearchBuilderController', SearchBuilderController);\r\n}"],"sourceRoot":"/source/"}